{% extends "base.html" %} {% block title %}PubMed Dataset Explorer - Visualization{% endblock title %}
{% block head_css_js %}
<script src="{{ url_for('static',filename='datasetTable.js') }}"></script>
{% endblock head_css_js%}
{% block body %}

<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary" style="--bs-breadcrumb-divider: '>';">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('index') }}">PubMed Dataset Explorer</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">{{ n_ids }} PubMed IDs</li>
          <li class="breadcrumb-item">{{ n_datasets }} GEO Datasets</li>
        </ol>
      </div>
    </div>
  </nav>
  <nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
      <button class="nav-link active" id="nav-datasets-tab" data-bs-toggle="tab" data-bs-target="#nav-datasets"
        type="button" role="tab" aria-controls="nav-datasets" aria-selected="true">
        <span class="tab-title">Datasets</span>
        <span class="tab-number">{{ n_datasets }}</span> datasets
      </button>
      <button class="nav-link" id="nav-clustering-tab" data-bs-toggle="tab" data-bs-target="#nav-clustering"
        type="button" role="tab" aria-controls="nav-clustering" aria-selected="false">
        <span class="tab-title">Clustering</span>
        <span class="tab-number">10</span> clusters
      </button>
    </div>
  </nav>
  <div class="tab-content" id="nav-tabContent">
    <div class="tab-pane fade show active" id="nav-datasets" role="tabpanel" aria-labelledby="nav-datasets-tab">
      <table id="datasets-table" class="table display table-hover">
        <thead>
          <th scope="col">Accession</th>
          <th scope="col">Title</th>
          <th scope="col">Organism</th>
          <th scope="col">Type</th>
          <th scope="col"># Samples</th>
          <th scope="col"></th>
        </thead>
      </table>
      <script>
        let geo_datasets = {{ datasets_json | tojson | safe }};
      </script>
    </div>
    <div class="tab-pane fade" id="nav-clustering" role="tabpanel" aria-labelledby="nav-clustering-tab">
      <main class="container mt-3">
        <div class="card mb-3">
          <div class="card-header">Clustering</div>
          <div class="card-body">
            <strong>Dataset similarity</strong>
            <p>Similar datasets are located close to each other. <br> The color of a point represnts the topic of the
              dataset.</p>
            <div class="graph">
              {{ clustering_html | safe }}
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">Topics</div>
          <div class="card-body">
            <strong>Topics</strong>
            <p>A topic is a collection of datasets that focus on a common subject, have elements in common etc.<br>
              Topics are determined based on text similarity.</p>
            <table id="topics-table" class="table display">
              <thead>
                <th scope="col">#</th>
                <th scope="col">Datasets</th>
                <th scope="col">Topics</th>
              </thead>
              <tbody>
                {% for index, datasets, color, topics in topic_table %}
                <tr scope="row">
                  <td>{{ index }} <i class="fa-solid fa-circle" style="color: {{ color }};"></i></td>
                  <td>{{ datasets }}</td>
                  <td>{{ topics }}</td>
                </tr>
                {% endfor %} data: geo_datasets,
                columns: [
                { data: 'id' },
                { data: 'title' },
                ]
              </tbody>
            </table>
            <script>let topic_table = new DataTable('#topics-table');</script>
          </div>
        </div>
      </main>
    </div>
  </div>
</body>
{% endblock body %}